# Production AFT site with CAC authentication
aft.foxxcyber.com {
    # Enable TLS with client certificate authentication for CAC
    tls {
        client_auth {
            mode request  # Request but don't require - allows both CAC and non-CAC users
            # For production, add DOD CA certificates:
            # trusted_ca_certs /path/to/dod-root-ca.pem
        }
    }

    # Pass client certificate information to the backend
    reverse_proxy localhost:3001 {
        # Forward client certificate details as headers when available
        header_up X-Client-Cert-Subject {tls_client_subject}
        header_up X-Client-Cert-Issuer {tls_client_issuer}
        header_up X-Client-Cert-Serial {tls_client_serial}
        header_up X-Client-Cert-Thumbprint {tls_client_fingerprint}
        header_up X-Client-Cert-Not-Before {tls_client_not_before}
        header_up X-Client-Cert-Not-After {tls_client_not_after}
        header_up X-Client-Cert-PEM {tls_client_certificate}
    }

    # Enable logging for debugging CAC authentication
    log {
        output file /var/log/caddy/aft-access.log
        level INFO
    }
}